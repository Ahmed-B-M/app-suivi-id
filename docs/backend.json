{
  "entities": {
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a filtered task from the Urbantz API with only the user-specified fields.",
      "properties": {
        "taskId": { "type": ["string", "number"] },
        "type": { "type": "string" },
        "date": { "type": "string", "format": "date-time" },
        "progress": { "type": "string" },
        "client": { "type": "string" },
        "platformName": { "type": "string" },
        "when": { "type": "string", "format": "date-time" },
        "closureDate": { "type": "string", "format": "date-time" },
        "updated": { "type": "string", "format": "date-time" },
        "attempts": { "type": "number" },
        "completedBy": { "type": "string" },
        "hubName": { "type": "string" },
        "roundName": { "type": "string" },
        "sequence": { "type": "number" },
        "associatedName": { "type": "string" },
        "driver": {
          "type": "object",
          "properties": {
            "firstName": { "type": "string" },
            "lastName": { "type": "string" },
            "email": { "type": "string" }
          }
        },
        "timeWindow": {
          "type": "object",
          "properties": {
            "start": { "type": "string", "format": "date-time" },
            "stop": { "type": "string", "format": "date-time" }
          }
        },
        "actualTime": {
          "type": "object",
          "properties": {
            "arrive": {
              "type": "object",
              "properties": {
                "when": { "type": "string", "format": "date-time" },
                "isCorrectAddress": { "type": "boolean" }
              }
            }
          }
        },
        "realServiceTime": {
          "type": "object",
          "properties": {
            "startTime": { "type": "string", "format": "date-time" },
            "endTime": { "type": "string", "format": "date-time" },
            "serviceTime": { "type": "number" }
          }
        },
        "serviceTime": { "type": "number" },
        "contact": {
          "type": "object",
          "properties": {
            "person": { "type": "string" },
            "phone": { "type": "string" },
            "email": { "type": "string" },
            "buildingInfo": {
              "type": "object",
              "properties": {
                "floor": { "type": "string" },
                "hasElevator": { "type": "boolean" },
                "digicode1": { "type": "string" },
                "hasInterphone": { "type": "boolean" },
                "interphoneCode": { "type": "string" }
              }
            }
          }
        },
        "location": {
          "type": "object",
          "properties": {
            "address": { "type": "string" },
            "street": { "type": "string" },
            "number": { "type": "string" },
            "zip": { "type": "string" },
            "city": { "type": "string" },
            "countryCode": { "type": "string" },
            "geometry": { "type": "array", "items": { "type": "number" } }
          }
        },
        "instructions": { "type": "string" },
        "dimensions": {
          "type": "object",
          "properties": {
            "volume": { "type": "number" },
            "bac": { "type": "number" },
            "poids": { "type": "number" }
          }
        },
        "items": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "status": { "type": "string" },
              "barcode": { "type": "string" },
              "type": { "type": "string" },
              "dimensions": {
                "type": "object",
                "properties": {
                  "poids": { "type": "number" }
                }
              },
              "log": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "when": { "type": "string", "format": "date-time" },
                    "to": { "type": "string" }
                  }
                }
              }
            }
          }
        },
        "execution": {
          "type": "object",
          "properties": {
            "contactless": { "type": "boolean" }
          }
        },
        "metadata": {
          "type": "object",
          "properties": {
            "notationLivreur": { "type": "number" },
            "commentaireLivr": { "type": "string" },
            "building": { "type": "string" }
          }
        }
      },
      "required": ["taskId"]
    },
    "Round": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Round",
      "type": "object",
      "description": "Represents a round fetched from the Urbantz API.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the round."
        },
        "name": {
          "type": "string",
          "description": "Name of the round."
        },
        "status": {
          "type": "string",
          "description": "Status of the round."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "Date of the round."
        }
      },
      "required": [
        "id",
        "name",
        "status",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores task data fetched from the Urbantz API. Includes `hubId` and `customerId` to reference related entities.",
          "params": [
            {
              "name": "taskId",
              "description": "Unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/rounds/{roundId}",
        "definition": {
          "entityName": "Round",
          "schema": {
            "$ref": "#/backend/entities/Round"
          },
          "description": "Stores round data fetched from the Urbantz API.",
          "params": [
            {
              "name": "roundId",
              "description": "Unique identifier for the round."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to store data fetched from the Urbantz API, focusing on Tasks and Rounds. A top-level collection for each entity is used. This design prioritizes simplicity for data retrieval and avoids nested collections, which simplifies querying and rule creation.\n\nAuthorization Independence is achieved because there is no authorization specified on this data. If authorization was needed, for example, if some tasks are private to certain users. The `tasks` collection would need to include denormalized authorization data (like a `members` map or `ownerId`) to avoid `get()` calls in security rules.\n\nQAPs (Rules are not Filters): The flat structure of each collection ensures secure list operations. Security rules can be applied to each collection based on the properties within the documents, without requiring filtering based on parent document data."
  }
}
