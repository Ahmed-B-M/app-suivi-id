/**
 * @file Firebase Security Rules for Firestore.
 *
 * @Core Philosophy: This ruleset allows any authenticated user to create and read data in all collections.
 *   This is a prototyping ruleset and is not suitable for production use.
 *   It provides the least restrictive access for authenticated users to create, read, update, and delete documents.
 *   All data validation is skipped to allow for rapid iteration on the data model.
 *   This ruleset focuses on granting access to authenticated users, but it does not implement any
 *   authorization logic based on user roles or ownership.
 *   All write operations are authorized for authenticated users, but NO data validation is performed.
 *   This means that data integrity is not guaranteed, and any authenticated user can write any data to any document.
 *
 * @Data Structure: The Firestore database consists of several top-level collections: `users`, `tasks`, `rounds`, `categorized_comments`,
 *   `nps_data`, `processed_nps_verbatims`, `action_notes`, and `action_notes_depot`.
 *   Each collection stores documents representing data fetched from the Urbantz API or derived from it.
 *
 * @Key Security Decisions:
 *   - All authenticated users can create, read, update, and delete documents in all collections.
 *   - No data validation is performed.
 *   - No authorization logic is implemented based on user roles or ownership.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any authenticated user to create and read user profiles.
     * @path /users/{userId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write user profiles.
     */
    match /users/{userId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read tasks.
     * @path /tasks/{taskId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write tasks.
     */
    match /tasks/{taskId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read rounds.
     * @path /rounds/{roundId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write rounds.
     */
    match /rounds/{roundId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read categorized comments.
     * @path /categorized_comments/{taskId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write categorized comments.
     */
    match /categorized_comments/{taskId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read NPS data.
     * @path /nps_data/{date}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write NPS data.
     */
    match /nps_data/{date} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read processed NPS verbatims.
     * @path /processed_nps_verbatims/{taskId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write processed NPS verbatims.
     */
    match /processed_nps_verbatims/{taskId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read action notes.
     * @path /action_notes/{date}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write action notes.
     */
    match /action_notes/{date} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to create and read action notes for a depot.
     * @path /action_notes_depot/{depotDateId}
     * @allow (create) request.auth != null
     * @allow (get) request.auth != null
     * @deny (create) request.auth == null
     * @deny (get) request.auth == null
     * @principle Allows authenticated users to read and write action notes for a depot.
     */
    match /action_notes_depot/{depotDateId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}