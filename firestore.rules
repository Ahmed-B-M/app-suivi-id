rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows a user to read and write their own profile data.
     * @path /users/{userId}
     * @allow (create) User with UID "U6p0PzhzYgPlEgPYt9sOVXXqO5Q2" can create their profile at /users/U6p0PzhzYgPlEgPYt9sOVXXqO5Q2.
     * @deny (create) User with UID "U6p0PzhzYgPlEgPYt9sOVXXqO5Q2" cannot create profile at /users/DIFFERENT_UID.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      function isSignedIn() {
        return request.auth != null;
      }

      function isOwner(userId) {
        return request.auth.uid == userId;
      }

      // Reads
      allow get: if isSignedIn() && isOwner(userId);
      allow list: if false;

      // Writes
      allow create: if isSignedIn() && isOwner(userId) && request.auth.uid == userId;
      allow update: if isSignedIn() && isOwner(userId) && request.auth.uid == userId;
      allow delete: if isSignedIn() && isOwner(userId);
    }

    /**
     * @description Allows public read access to tasks and restricts write access to owners.
     * @path /tasks/{taskId}
     * @allow (get) Any user can read a task.
     * @allow (create) A user can create a task if they are the owner (request.resource.data.ownerId == request.auth.uid).
     * @deny (create) A user cannot create a task if they are not the owner.
     * @principle Allows public read with owner-only writes.
     */
    match /tasks/{taskId} {
        function isSignedIn() {
            return request.auth != null;
        }

        function isOwner(ownerId) {
            return request.auth.uid == ownerId;
        }

        // Reads
        allow get, list: if true;

        // Writes
        allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
        allow update: if isSignedIn() && isOwner(resource.data.ownerId);
        allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
    }

    /**
     * @description Allows public read access to rounds and restricts write access to owners.
     * @path /rounds/{roundId}
     * @allow (get) Any user can read a round.
     * @allow (create) A user can create a round if they are the owner (request.resource.data.ownerId == request.auth.uid).
     * @deny (create) A user cannot create a round if they are not the owner.
     * @principle Allows public read with owner-only writes.
     */
    match /rounds/{roundId} {
      function isSignedIn() {
          return request.auth != null;
      }

      function isOwner(ownerId) {
          return request.auth.uid == ownerId;
      }

      // Reads
      allow get, list: if true;

      // Writes
      allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
      allow update: if isSignedIn() && isOwner(resource.data.ownerId);
      allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
    }

        /**
         * @description Allows public read access to categorized comments and restricts write access to owners.
         * @path /categorized_comments/{taskId}
         * @allow (get) Any user can read a categorized comment.
         * @allow (create) A user can create a categorized comment if they are the owner (request.resource.data.ownerId == request.auth.uid).
         * @deny (create) A user cannot create a categorized comment if they are not the owner.
         * @principle Allows public read with owner-only writes.
         */
        match /categorized_comments/{taskId} {
            function isSignedIn() {
                return request.auth != null;
            }

            function isOwner(ownerId) {
                return request.auth.uid == ownerId;
            }

            // Reads
            allow get, list: if true;

            // Writes
            allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
            allow update: if isSignedIn() && isOwner(resource.data.ownerId);
            allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
        }

        /**
         * @description Allows public read access to NPS data and restricts write access to owners.
         * @path /nps_data/{date}
         * @allow (get) Any user can read NPS data.
         * @allow (create) A user can create NPS data if they are the owner (request.resource.data.ownerId == request.auth.uid).
         * @deny (create) A user cannot create NPS data if they are not the owner.
         * @principle Allows public read with owner-only writes.
         */
        match /nps_data/{date} {
            function isSignedIn() {
                return request.auth != null;
            }

            function isOwner(ownerId) {
                return request.auth.uid == ownerId;
            }

            // Reads
            allow get, list: if true;

            // Writes
            allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
            allow update: if isSignedIn() && isOwner(resource.data.ownerId);
            allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
        }

        /**
         * @description Allows public read access to processed NPS verbatims and restricts write access to owners.
         * @path /processed_nps_verbatims/{taskId}
         * @allow (get) Any user can read a processed NPS verbatim.
         * @allow (create) A user can create a processed NPS verbatim if they are the owner (request.resource.data.ownerId == request.auth.uid).
         * @deny (create) A user cannot create a processed NPS verbatim if they are not the owner.
         * @principle Allows public read with owner-only writes.
         */
        match /processed_nps_verbatims/{taskId} {
            function isSignedIn() {
                return request.auth != null;
            }

            function isOwner(ownerId) {
                return request.auth.uid == ownerId;
            }

            // Reads
            allow get, list: if true;

            // Writes
            allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
            allow update: if isSignedIn() && isOwner(resource.data.ownerId);
            allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
        }

        /**
         * @description Allows public read access to action notes and restricts write access to owners.
         * @path /action_notes/{date}
         * @allow (get) Any user can read an action note.
         * @allow (create) A user can create an action note if they are the owner (request.resource.data.ownerId == request.auth.uid).
         * @deny (create) A user cannot create an action note if they are not the owner.
         * @principle Allows public read with owner-only writes.
         */
        match /action_notes/{date} {
            function isSignedIn() {
                return request.auth != null;
            }

            function isOwner(ownerId) {
                return request.auth.uid == ownerId;
            }

            // Reads
            allow get, list: if true;

            // Writes
            allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
            allow update: if isSignedIn() && isOwner(resource.data.ownerId);
            allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
        }

        /**
         * @description Allows public read access to depot action notes and restricts write access to owners.
         * @path /action_notes_depot/{depotDateId}
         * @allow (get) Any user can read a depot action note.
         * @allow (create) A user can create a depot action note if they are the owner (request.resource.data.ownerId == request.auth.uid).
         * @deny (create) A user cannot create a depot action note if they are not the owner.
         * @principle Allows public read with owner-only writes.
         */
        match /action_notes_depot/{depotDateId} {
            function isSignedIn() {
                return request.auth != null;
            }

            function isOwner(ownerId) {
                return request.auth.uid == ownerId;
            }

            // Reads
            allow get, list: if true;

            // Writes
            allow create: if isSignedIn() && isOwner(request.resource.data.ownerId);
            allow update: if isSignedIn() && isOwner(resource.data.ownerId);
            allow delete: if isSignedIn() && isOwner(resource.data.ownerId);
        }
  }
}