/**
 * @fileoverview Firestore Security Rules for the Urbantz API data model.
 *
 * Core Philosophy:
 * This ruleset allows any authenticated user to read and write all data.
 * This is intended for rapid prototyping and should be replaced with a more
 * restrictive model in a production environment.
 *
 * Data Structure:
 * - /users/{userId}: Stores user profile information. Access is restricted to the owner.
 * - /tasks/{taskId}: Stores task data fetched from the Urbantz API.
 * - /rounds/{roundId}: Stores round data fetched from the Urbantz API.
 * - /categorized_comments/{taskId}: Stores categorized customer comments related to tasks.
 * - /nps_data/{date}: Stores NPS analysis results for a specific date.
 * - /processed_nps_verbatims/{taskId}: Stores processed NPS detractor verbatims related to tasks.
 * - /action_notes/{date}: Stores daily action notes.
 * - /action_notes_depot/{depotDateId}: Stores daily action notes for a specific depot.
 *
 * Key Security Decisions:
 * - No role-based access control is enforced.
 * - All authenticated users can create, read, update, and delete all documents.
 * - List operations are generally allowed for all collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Allows any authenticated user to manage user profiles.
     * @path /users/{userId}
     * @allow (create) Signed-in user with matching userId.
     * @deny (create) Signed-in user with non-matching userId.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage user profiles.
     */
    match /users/{userId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage tasks.
     * @path /tasks/{taskId}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage tasks.
     */
    match /tasks/{taskId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage rounds.
     * @path /rounds/{roundId}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage rounds.
     */
    match /rounds/{roundId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage categorized comments.
     * @path /categorized_comments/{taskId}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage categorized comments.
     */
    match /categorized_comments/{taskId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage NPS data.
     * @path /nps_data/{date}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage NPS data.
     */
    match /nps_data/{date} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage processed NPS verbatims.
     * @path /processed_nps_verbatims/{taskId}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage processed NPS verbatims.
     */
    match /processed_nps_verbatims/{taskId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage action notes.
     * @path /action_notes/{date}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage action notes.
     */
    match /action_notes/{date} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to manage depot action notes.
     * @path /action_notes_depot/{depotDateId}
     * @allow (create) Signed-in user.
     * @deny (create) No specific denial condition in prototyping mode.
     * @allow (get, list, update, delete) Signed-in user.
     * @principle Allows any authenticated user to manage depot action notes.
     */
    match /action_notes_depot/{depotDateId} {
      allow create: if isSignedIn();
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }
  }
}