rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Default rule: Deny all reads and writes unless explicitly allowed.
    match /{document=**} {
      allow read, write: if false;
    }

    // Allow authenticated users to read and write their own user profile.
    match /users/{userId} {
      allow read, create, update: if request.auth.uid == userId;
    }

    // Allow read-only access for most collections to authenticated users.
    // Writes are handled by more specific rules or server-side actions.
    match /tasks/{taskId} {
      allow read, list: if request.auth != null;
      allow create, update, delete: if request.auth != null; // Kept for admin/server-side tools
    }

    match /rounds/{roundId} {
      allow read, list: if request.auth != null;
      allow create, update, delete: if request.auth != null;
    }

    // Categorized comments can be read by any authenticated user.
    // Creation/update should be restricted, e.g., to specific roles or server processes.
    match /categorized_comments/{taskId} {
      allow read, list: if request.auth != null;
      allow create, update: if request.auth != null; // Assuming authorized users/server can update
    }

    match /nps_data/{date} {
      allow read, list: if request.auth != null;
      allow create, update, delete: if request.auth != null;
    }

    match /processed_nps_verbatims/{taskId} {
      allow read, list: if request.auth != null;
      allow create, update: if request.auth != null;
    }

    match /action_notes_depot/{depotDateId} {
      allow read, list: if request.auth != null;
      allow create, update: if request.auth != null;
    }
    
    match /notifications/{notificationId} {
      allow read, list, update: if request.auth != null; // Users can read/update their notifications
      allow create: if request.auth != null; // Or restrict to server
    }
  }
}
