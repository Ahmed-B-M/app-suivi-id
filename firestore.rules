/**
 * @file Firestore Security Rules
 * @description This ruleset allows anyone to read Tasks and Rounds data, but only allows writes if the document does not already exist or if there are updates. This approach prevents overwriting existing data and ensures that only new or modified information is saved. The data structure consists of two top-level collections: `tasks` and `rounds`.
 * @dataStructure
 * - `/tasks/{taskId}`: Stores task data.
 * - `/rounds/{roundId}`: Stores round data.
 * @keySecurityDecisions
 * - Public read access to all data.
 * - Prevents overwriting existing data in the `tasks` and `rounds` collections.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows anyone to read task data, but only allows writes if the document does not already exist or if there are updates.
     * @path /tasks/{taskId}
     * @allow (get, list): Any user can read task data.
     * @allow (create): Any user can create a task document.
     * @allow (update): Any user can update a task document.
     * @allow (delete): No one can delete a task document.
     * @deny (delete): No one can delete a task document.
     * @principle Allows public read access and new or updated data to be saved.
     */
    match /tasks/{taskId} {
      allow get, list: if true;
      allow create: if !exists(resource.data);
      allow update: if true;
      allow delete: if false;
    }

    /**
     * @description Allows anyone to read round data, but only allows writes if the document does not already exist or if there are updates.
     * @path /rounds/{roundId}
     * @allow (get, list): Any user can read round data.
     * @allow (create): Any user can create a round document.
     * @allow (update): Any user can update a round document.
     * @allow (delete): No one can delete a round document.
     * @deny (delete): No one can delete a round document.
     * @principle Allows public read access and new or updated data to be saved.
     */
    match /rounds/{roundId} {
      allow get, list: if true;
      allow create: if !exists(resource.data);
      allow update: if true;
      allow delete: if false;
    }
  }
}